{% extends "base.html" %}
{% block title %}{{ list.title }} â€” LingoList{% endblock %}

{% block content %}
<div class="container">
    <div class="detail-header">
        <h1>{{ list.title }}</h1>
        {% if list.description %}
        <p>{{ list.description }}</p>
        {% endif %}
        <div class="detail-actions">
            <a href="{% url 'lists:list_index' %}" class="btn btn-outline btn-sm">&larr; All lists</a>
            {% if is_owner %}
            <form method="post" action="{% url 'lists:list_delete' pk=list.pk %}"
                  onsubmit="return confirm('Delete this list and all its items?')">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">Delete list</button>
            </form>
            {% endif %}
        </div>
    </div>

    <!-- Add item form -->
    <div class="card mt-2">
        <form class="add-item-form"
              hx-post="{% url 'lists:item_add' pk=list.pk %}"
              hx-target="#item-list"
              hx-swap="innerHTML"
              hx-on::after-request="if(event.detail.successful) this.reset()">
            {% csrf_token %}
            {{ item_form.text }}
            <button type="submit" class="btn btn-primary">Add</button>
            <span class="htmx-indicator">...</span>
        </form>

        <div id="item-list">
            {% include "partials/item_list.html" %}
        </div>
    </div>

    <!-- Collaborators -->
    <div class="collaborator-section">
        <h2>Sharing</h2>

        <div class="card">
            <p class="text-sm text-muted mb-1">Share this link to invite collaborators:</p>
            <div class="share-link">
                <input type="text" readonly
                       value="{{ request.scheme }}://{{ request.get_host }}{{ list.get_share_url }}"
                       id="share-url"
                       onclick="this.select()">
                <button class="btn btn-outline btn-sm"
                        onclick="navigator.clipboard.writeText(document.getElementById('share-url').value)">
                    Copy
                </button>
            </div>

            <p class="text-sm mb-1"><strong>Owner:</strong> {{ list.owner }}</p>

            <div id="collaborator-list">
                {% include "partials/collaborator_list.html" %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
